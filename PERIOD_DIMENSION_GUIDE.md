# 期数维度管理系统使用指南

## 概述

新的期数维度管理系统允许一个达人参与多个期数的活动，每个期数都有独立的费用、作品和数据表现。这样可以更好地跟踪达人在不同时期的合作情况。

## 数据结构变化

### 原有结构

```javascript
{
  nickname: "达人昵称",
  period: "2024年第1期",
  fee: 5000,
  mainPublishLink: "作品链接",
  likes: 1000,
  // ... 其他字段
}
```

### 新结构

```javascript
{
  nickname: "达人昵称",
  // 基本信息（不随期数变化）
  platform: "小红书",
  followers: "10万",
  xiaohongshuId: "123456",

  // 期数数据数组
  periodData: [
    {
      period: "2024年第1期",
      fee: 5000,
      cooperationMethod: "付费合作",
      mainPublishLink: "第1期作品链接",
      likes: 1000,
      comments: 50,
      collections: 200,
      published: true,
      // ... 其他期数相关字段
    },
    {
      period: "2024年第2期",
      fee: 6000,
      cooperationMethod: "免费体验",
      mainPublishLink: "第2期作品链接",
      likes: 1500,
      comments: 80,
      collections: 300,
      published: false,
      // ... 其他期数相关字段
    }
  ]
}
```

## 功能特性

### 1. 期数维度管理

- **期数统计**: 查看每个期数的参与达人数、总费用、总互动量、发布率
- **期数达人列表**: 按期数查看所有参与的达人及其数据
- **期数数据编辑**: 为达人添加、编辑、删除特定期数的数据

### 2. 作品维度管理

- **作品筛选**: 按期数、达人、发布状态等条件筛选作品
- **作品统计**: 总作品数、已发布数量、总互动量、总投入
- **批量操作**: 批量刷新作品数据、导出作品信息

### 3. 数据迁移

- **自动迁移**: 将现有的单期数数据迁移到新的期数维度结构
- **向后兼容**: 保留原有字段，确保系统平滑过渡

## API 接口

### 期数维度 API

#### 获取期数达人列表

```
GET /api/periods/{period}/darens
```

#### 添加期数数据

```
POST /api/darens/{id}/periods
{
  "period": "2024年第3期",
  "fee": 7000,
  "cooperationMethod": "付费合作",
  "mainPublishLink": "作品链接"
}
```

#### 更新期数数据

```
PUT /api/darens/{id}/periods/{period}
{
  "fee": 8000,
  "likes": 2000,
  "published": true
}
```

#### 删除期数数据

```
DELETE /api/darens/{id}/periods/{period}
```

#### 获取期数统计

```
GET /api/periods/{period}/stats
```

### 作品维度 API

#### 获取作品列表

```
GET /api/works?periods[]=2024年第1期&darenIds[]=达人ID
```

## 使用步骤

### 1. 数据迁移

首先运行数据迁移脚本：

```bash
cd packages/backend
node scripts/migrate-to-period-structure.js
```

### 2. 启动服务

```bash
# 启动后端
cd packages/backend
npm start

# 启动前端
cd packages/frontend
npm run dev
```

### 3. 访问新功能

- 期数维度管理: `/periods`
- 作品维度管理: `/works`

## 操作示例

### 为达人添加新期数数据

1. 在期数维度管理页面选择期数
2. 点击"编辑期数数据"按钮
3. 填写该期数的费用、合作方式、作品链接等信息
4. 保存数据

### 查看作品表现

1. 在作品维度管理页面
2. 选择要查看的期数和达人
3. 点击"查询作品"
4. 查看作品的点赞、评论、收藏等数据

### 批量刷新数据

1. 在作品维度页面选择要刷新的作品
2. 点击"批量刷新"按钮
3. 系统会自动从小红书获取最新的数据表现

## 注意事项

1. **数据迁移**: 首次使用前请务必运行数据迁移脚本
2. **向后兼容**: 原有的单期数字段会保留，但建议逐步迁移到新结构
3. **Cookie 设置**: 刷新小红书数据需要设置有效的 Cookie
4. **期数命名**: 建议使用统一的期数命名规范，如"2024 年第 1 期"

## 优势

1. **灵活性**: 一个达人可以参与多个期数，数据独立管理
2. **可追溯性**: 可以查看达人在不同期数的表现变化
3. **统计分析**: 可以按期数进行横向对比分析
4. **数据完整性**: 每个期数的数据都有完整的生命周期跟踪

## 后续规划

1. **数据分析**: 增加期数对比分析功能
2. **自动化**: 自动检测新期数并提醒添加达人
3. **报表导出**: 支持按期数导出详细报表
4. **移动端**: 开发移动端管理界面
